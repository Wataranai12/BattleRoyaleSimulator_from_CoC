<%# app/views/characters/show.html.erb %>
<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-md-10 col-lg-9">

      <%# „Éò„ÉÉ„ÉÄ„Éº %>
      <div class="d-flex align-items-center justify-content-between mb-4">
        <h2 class="fw-bold mb-0">üìã Êé¢Á¥¢ËÄÖ„Ç´„Éº„ÉâÁ¢∫Ë™ç</h2>
        <%= link_to "‚Üê Êà¶ÈóòÊ∫ñÂÇô„Å´Êàª„Çã",
              new_battle_path,
              class: "btn btn-outline-secondary btn-sm" %>
      </div>

      <%= form_with model: @character, local: true do |f| %>

        <%# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Âü∫Êú¨ÊÉÖÂ†± ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ %>
        <div class="card shadow-sm mb-4">
          <div class="card-header fw-bold bg-dark text-white">Âü∫Êú¨ÊÉÖÂ†±</div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-4">
                <%= f.label :name, "ÂêçÂâç", class: "form-label fw-bold" %>
                <%= f.text_field :name, class: "form-control" %>
              </div>
              <div class="col-md-4">
                <%= f.label :max_hp, "ÊúÄÂ§ßHP", class: "form-label fw-bold" %>
                <%= f.number_field :max_hp, class: "form-control" %>
              </div>
              <div class="col-md-4">
                <%= f.label :damage_bonus, "„ÉÄ„É°„Éº„Ç∏„Éú„Éº„Éä„Çπ", class: "form-label fw-bold" %>
                <%= f.text_field :damage_bonus, class: "form-control" %>
              </div>
            </div>
          </div>
        </div>

        <%# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ËÉΩÂäõÂÄ§ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ %>
        <div class="card shadow-sm mb-4">
          <div class="card-header fw-bold bg-dark text-white">ËÉΩÂäõÂÄ§</div>
          <div class="card-body">
            <div class="row g-3">
              <%= f.fields_for :characteristics do |cf| %>
                <div class="col-6 col-md-3">
                  <%= cf.label :value, cf.object.name.upcase, class: "form-label fw-bold text-muted small" %>
                  <div class="input-group">
                    <%= cf.hidden_field :name %>
                    <%= cf.number_field :value, class: "form-control text-center", min: 1, max: 99 %>
                    <span class="input-group-text text-muted small">
                      <%= cf.object.value * 5 %>%
                    </span>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        </div>

        <%# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ÊäÄËÉΩ‰∏ÄË¶ß ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ %>
        <div class="card shadow-sm mb-4">
          <div class="card-header fw-bold bg-dark text-white">ÊäÄËÉΩ</div>
          <div class="card-body p-0">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th>ÊäÄËÉΩÂêç</th>
                  <th>ÊàêÂäüÁéá</th>
                  <th>„Ç´„ÉÜ„Ç¥„É™</th>
                </tr>
              </thead>
              <tbody>
                <%= f.fields_for :skills do |sf| %>
                  <tr>
                    <td>
                      <%= sf.hidden_field :category %>
                      <%= sf.text_field :name, class: "form-control form-control-sm border-0 bg-transparent" %>
                    </td>
                    <td>
                      <div class="input-group input-group-sm" style="width: 100px;">
                        <%= sf.number_field :success, class: "form-control form-control-sm", min: 1, max: 100 %>
                        <span class="input-group-text">%</span>
                      </div>
                    </td>
                    <td>
                      <span class="badge <%= category_badge_class(sf.object.category) %>">
                        <%= sf.object.category %>
                      </span>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>

        <%# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ÊîªÊíÉÊâãÊÆµ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ %>
        <div class="card shadow-sm mb-4">
          <div class="card-header fw-bold bg-dark text-white">ÊîªÊíÉÊâãÊÆµ</div>
          <div class="card-body p-0">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th>Ë°®Á§∫Âêç</th>
                  <th>„ÉÄ„É°„Éº„Ç∏</th>
                  <th>DB</th>
                  <th>MA</th>
                </tr>
              </thead>
              <tbody>
                <%= f.fields_for :attack_methods do |af| %>
                  <tr>
                    <td>
                      <%= af.text_field :show_name, class: "form-control form-control-sm border-0 bg-transparent" %>
                    </td>
                    <td>
                      <%= af.text_field :base_damage, class: "form-control form-control-sm", style: "width: 80px;" %>
                    </td>
                    <td class="text-center">
                      <%= af.check_box :can_apply_db, class: "form-check-input" %>
                    </td>
                    <td class="text-center">
                      <%= af.check_box :can_apply_ma, class: "form-check-input" %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>

        <%# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ „Éú„Çø„É≥È°û ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ %>
        <div class="d-flex gap-3 justify-content-end">
          <%= f.submit "Â§âÊõ¥„Çí‰øùÂ≠ò",
                class: "btn btn-primary px-4" %>

          <% if session[:pending_slot].present? %>
            <%= link_to "„Åì„ÅÆ„Ç≠„É£„É©„ÅßÊà¶ÈóòÊ∫ñÂÇô„Å∏",
                  new_battle_path(character_id: @character.id, slot: session[:pending_slot]),
                  class: "btn btn-danger px-4 fw-bold" %>
          <% else %>
            <%= link_to "Êà¶ÈóòÊ∫ñÂÇô„Å´Êàª„Çã",
                  new_battle_path,
                  class: "btn btn-outline-secondary px-4" %>
          <% end %>
        </div>

      <% end %>

    </div>
  </div>
</div>
